<link rel="import" href="elements.html">
<link rel="import" href="socobo-inventory-create.html">
<link rel="import" href="socobo-inventory-overview.html">

<dom-module id="socobo-inventory">
  <template>
    <style>
        :host {
        display: block;
        }

        .button-add {
        position: absolute;
        right: 30px;
        bottom: 30px;
        --paper-fab-background: var(--accent-color);
        }
    </style>
    <div>
      <socobo-inventory-create 
        id="inventoryCreateDialog" 
        on-edit-item="_saveItem"
      ></socobo-inventory-create>
      <firebase-collection
        id="inventoryCollection"
        order-by-child="created"
        location="{{location}}"
        data="{{data}}"></firebase-collection>
      <socobo-inventory-overview 
        on-edit_request="_editItem"
        data="[[data]]">
      </socobo-inventory-overview>
      <paper-fab id="inventoryButtonAdd" class="button-add" icon="add" on-click="_createItem"></paper-fab>
    </div>
  </template>

  <script>
    (function () {
        Polymer({
        is: 'socobo-inventory',

        properties: {

            /*Object containing the user information. Must have following
            properties:
            - userId,
            - firebaseUrl,
            - expires
            */
            userLogin: {
              type: Object
            },

            /*Specifies the location of the Firebase database
            */
            location: {
              computed: "_handleLogin(userLogin)",
              type: String,
              value: "https://socobo.firebaseio.com/"
            }
        },

        /*Construct firebase url for user's inventory from userLogin object</br>
        @param {Object} login
        @method _handleLogin
        */
        _handleLogin: function(login) {
          return login.firebaseUrl + "inventory/" + login.userId;
        },

        /*Display dialog to create new inventory items
        */
        _createItem: function () {
          this.$.inventoryCreateDialog.style.display = "block";
          this.$.inventoryCreateDialog.show(this.userLogin);
        },
        
        /* Display dialog to edit inventory items
        */
        _editItem: function(e) {
          this.$.inventoryCreateDialog.style.display = "block";
          this.$.inventoryCreateDialog.show(this.userLogin, e.detail);
        },
        
        /* Save changes made to inventory items
        */
        _saveItem: function(e) {
          var item = e.detail;
          var self = this;
          if (item.id) {
            var ref = new Firebase(this._handleLogin(this.userLogin) + "/" + item.id);
            ref.update(item, function(error) {
              if (error) {
                alert("There was an error updating the item");
                console.log(error);
            } else {
              self.$.inventoryCreateDialog.hide();
            }
            });
          }
        }
        });
    })();
  </script>
</dom-module>
